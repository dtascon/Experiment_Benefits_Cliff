{% extends "global/Page.html" %}

{% block title %}
Feedback on Your Decisions
{% endblock %}

{% block content %}

<div style="max-width: 1000px; margin: 0 auto; padding: 20px;">

    <!-- Progress Indicator -->
    <div style="background-color: #f0f0f0; padding: 15px; margin-bottom: 25px; border-radius: 4px;">
        <p style="margin: 0; font-size: 0.95em; color: #666;">
            <strong>Part 3 of 4:</strong> Review your decisions and the actual financial impact
        </p>
    </div>

    <h2 style="color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Summary of Your Decisions</h2>

    <!-- Stage 1 Summary -->
    <div style="background-color: #f5f5f5; padding: 20px; margin: 20px 0; border-left: 5px solid #757575; border-radius: 4px;">
        <h3 style="margin-top: 0; color: #424242;">Stage 1: Initial Decision (Text Only)</h3>
        <table style="width: 100%; line-height: 2;">
            <tr>
                <td style="padding: 5px 0; width: 60%;"><strong>Your decision:</strong></td>
                <td style="padding: 5px 0;">
                    {% if player.stage1_decision == 1 %}
                        <span style="color: #1976d2; font-weight: bold;">âœ“ Accept the offer</span>
                    {% else %}
                        <span style="color: #757575; font-weight: bold;">âœ— Keep current job</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td style="padding: 5px 0;"><strong>You estimated the change would be:</strong></td>
                <td style="padding: 5px 0;">
                    {% if player.stage1_perceived_delta > 0 %}+{% endif %}${{ player.stage1_perceived_delta }}/month
                </td>
            </tr>
        </table>
    </div>

    <!-- Stage 2 Summary -->
    <div style="background-color: #e3f2fd; padding: 20px; margin: 20px 0; border-left: 5px solid #1976d2; border-radius: 4px;">
        <h3 style="margin-top: 0; color: #1565c0;">
            Stage 2: Decision After Seeing
            {% if treatment_format == "dashboard" %}Dashboard{% else %}AI Analysis{% endif %}
        </h3>
        <table style="width: 100%; line-height: 2;">
            <tr>
                <td style="padding: 5px 0; width: 60%;"><strong>Your decision:</strong></td>
                <td style="padding: 5px 0;">
                    {% if player.stage2_decision == 1 %}
                        <span style="color: #1976d2; font-weight: bold;">âœ“ Accept the offer</span>
                    {% else %}
                        <span style="color: #757575; font-weight: bold;">âœ— Keep current job</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td style="padding: 5px 0;"><strong>You estimated the change would be:</strong></td>
                <td style="padding: 5px 0;">
                    {% if player.stage2_perceived_delta > 0 %}+{% endif %}${{ player.stage2_perceived_delta }}/month
                </td>
            </tr>
        </table>
    </div>

    <!-- Actual Impact -->
    <div style="background-color: #fff3e0; padding: 25px; margin: 30px 0; border: 3px solid #ff9800; border-radius: 4px;">
        <h2 style="margin-top: 0; color: #e65100;">ðŸ“Š The Actual Financial Impact</h2>

        <div style="background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #333;">Complete Breakdown:</h3>

            <table style="width: 100%; line-height: 2; border-collapse: collapse;">
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="text-align: left; padding: 10px 0;"></th>
                    <th style="text-align: center; padding: 10px 0; color: #757575;">Current Job</th>
                    <th style="text-align: center; padding: 10px 0; color: #1565c0;">New Job</th>
                    <th style="text-align: center; padding: 10px 0; color: #e65100;">Change</th>
                </tr>
                <tr>
                    <td style="padding: 8px 0;"><strong>Monthly Earnings</strong></td>
                    <td style="text-align: center; padding: 8px 0;">${{ current_monthly_gross }}</td>
                    <td style="text-align: center; padding: 8px 0;">${{ offer_monthly_gross }}</td>
                    <td style="text-align: center; padding: 8px 0; font-weight: bold; color: #2e7d32;">
                        +${{ player.delta_net_earnings }}
                    </td>
                </tr>
                <tr style="background-color: #f9f9f9;">
                    <td style="padding: 8px 0;"><strong>Total Benefits</strong></td>
                    <td style="text-align: center; padding: 8px 0;">${{ player.cur_benefits_total }}</td>
                    <td style="text-align: center; padding: 8px 0;">${{ player.off_benefits_total }}</td>
                    <td style="text-align: center; padding: 8px 0; font-weight: bold;
                        {% if player.delta_benefits_total > 0 %}color: #2e7d32;
                        {% elif player.delta_benefits_total < 0 %}color: #c62828;
                        {% else %}color: #666;{% endif %}">
                        {% if player.delta_benefits_total > 0 %}+{% endif %}${{ player.delta_benefits_total }}
                    </td>
                </tr>
            </table>

            <div style="background-color: #e8f5e9; padding: 20px; margin-top: 20px; border-radius: 8px; border: 2px solid #4caf50;">
                <div style="text-align: center;">
                    <div style="font-size: 1.2em; color: #2e7d32; margin-bottom: 10px;">
                        <strong>NET CHANGE IN TOTAL MONTHLY RESOURCES:</strong>
                    </div>
                    <div style="font-size: 3em; font-weight: bold;
                        {% if player.delta_true_net_income > 0 %}color: #2e7d32;
                        {% elif player.delta_true_net_income < 0 %}color: #c62828;
                        {% else %}color: #666;{% endif %}">
                        {% if player.delta_true_net_income > 0 %}+{% endif %}${{ player.delta_true_net_income }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Benefits Breakdown -->
        <div style="background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h4 style="margin-top: 0; color: #333;">How Individual Benefits Changed:</h4>
            <ul style="line-height: 2;">
                <li>SNAP (food assistance):
                    <strong style="{% if delta_snap < 0 %}color: #c62828;{% elif delta_snap > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_snap > 0 %}+{% endif %}${{ delta_snap }}
                    </strong>
                </li>
                <li>Medicaid/CHIP (health insurance):
                    <strong style="{% if delta_medicaid < 0 %}color: #c62828;{% elif delta_medicaid > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_medicaid > 0 %}+{% endif %}${{ delta_medicaid }}
                    </strong>
                </li>
                {% if show_ccdf %}
                <li>Child care subsidy (CCDF):
                    <strong style="{% if delta_ccdf < 0 %}color: #c62828;{% elif delta_ccdf > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_ccdf > 0 %}+{% endif %}${{ delta_ccdf }}
                    </strong>
                </li>
                {% endif %}
                {% if show_tanf %}
                <li>TANF (cash assistance):
                    <strong style="{% if delta_tanf < 0 %}color: #c62828;{% elif delta_tanf > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_tanf > 0 %}+{% endif %}${{ delta_tanf }}
                    </strong>
                </li>
                {% endif %}
                {% if show_wic %}
                <li>WIC (nutrition program):
                    <strong style="{% if delta_wic < 0 %}color: #c62828;{% elif delta_wic > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_wic > 0 %}+{% endif %}${{ delta_wic }}
                    </strong>
                </li>
                {% endif %}
                {% if show_head_start %}
                <li>Head Start (preschool):
                    <strong style="{% if delta_head_start < 0 %}color: #c62828;{% elif delta_head_start > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_head_start > 0 %}+{% endif %}${{ delta_head_start }}
                    </strong>
                </li>
                {% endif %}
                <li>EITC (tax credit):
                    <strong style="{% if delta_eitc < 0 %}color: #c62828;{% elif delta_eitc > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_eitc > 0 %}+{% endif %}${{ delta_eitc }}
                    </strong>
                </li>
                {% if show_disability %}
                <li>SSDI (disability insurance):
                    <strong style="{% if delta_ssdi < 0 %}color: #c62828;{% elif delta_ssdi > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_ssdi > 0 %}+{% endif %}${{ delta_ssdi }}
                    </strong>
                </li>
                <li>SSI (supplemental income):
                    <strong style="{% if delta_ssi < 0 %}color: #c62828;{% elif delta_ssi > 0 %}color: #2e7d32;{% endif %}">
                        {% if delta_ssi > 0 %}+{% endif %}${{ delta_ssi }}
                    </strong>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <!-- Accuracy Feedback -->
    <div style="background-color: #e3f2fd; padding: 25px; margin: 30px 0; border-left: 5px solid #2196f3; border-radius: 4px;">
        <h3 style="margin-top: 0; color: #1565c0;">ðŸ“ˆ How Accurate Were Your Estimates?</h3>

        <div style="background-color: white; padding: 20px; border-radius: 8px; margin: 15px 0;">
            <h4 style="margin-top: 0; color: #555;">Stage 1 Estimate:</h4>
            <p style="font-size: 1.1em; line-height: 1.6;">
                You estimated: <strong>{% if player.stage1_perceived_delta > 0 %}+{% endif %}${{ player.stage1_perceived_delta }}</strong><br>
                Actual change: <strong>{% if player.delta_true_net_income > 0 %}+{% endif %}${{ player.delta_true_net_income }}</strong><br>
                {% if stage1_error != None %}
                Your estimate was
                <strong style="{% if stage1_error_abs < 100 %}color: #2e7d32;{% elif stage1_error_abs < 300 %}color: #ff9800;{% else %}color: #c62828;{% endif %}">
                    {% if stage1_error > 0 %}${{ stage1_error_abs }} too high{% elif stage1_error < 0 %}${{ stage1_error_abs }} too low{% else %}exactly right!{% endif %}
                </strong>
                {% endif %}
            </p>
        </div>

        <div style="background-color: white; padding: 20px; border-radius: 8px; margin: 15px 0;">
            <h4 style="margin-top: 0; color: #555;">Stage 2 Estimate (After Seeing {% if treatment_format == "dashboard" %}Dashboard{% else %}AI Analysis{% endif %}):</h4>
            <p style="font-size: 1.1em; line-height: 1.6;">
                You estimated: <strong>{% if player.stage2_perceived_delta > 0 %}+{% endif %}${{ player.stage2_perceived_delta }}</strong><br>
                Actual change: <strong>{% if player.delta_true_net_income > 0 %}+{% endif %}${{ player.delta_true_net_income }}</strong><br>
                {% if stage2_error != None %}
                Your estimate was
                <strong style="{% if stage2_error_abs < 100 %}color: #2e7d32;{% elif stage2_error_abs < 300 %}color: #ff9800;{% else %}color: #c62828;{% endif %}">
                    {% if stage2_error > 0 %}${{ stage2_error_abs }} too high{% elif stage2_error < 0 %}${{ stage2_error_abs }} too low{% else %}exactly right!{% endif %}
                </strong>
                {% endif %}
            </p>
        </div>

        {% if stage1_error != None and stage2_error != None %}
        <div style="background-color: #fff3e0; padding: 15px; margin: 15px 0; border-left: 4px solid #ff9800; border-radius: 4px;">
            <p style="margin: 0; font-size: 1.05em;">
                <strong>ðŸ’¡ Improvement:</strong>
                {% if stage2_error_abs < stage1_error_abs %}
                    Your estimate improved by ${{ stage1_error_abs|add:"-"|add:stage2_error_abs|abs }} after seeing the {% if treatment_format == "dashboard" %}dashboard{% else %}AI analysis{% endif %}.
                {% elif stage2_error_abs > stage1_error_abs %}
                    Your estimate was ${{ stage2_error_abs|add:"-"|add:stage1_error_abs|abs }} further from the actual value after seeing the {% if treatment_format == "dashboard" %}dashboard{% else %}AI analysis{% endif %}.
                {% else %}
                    Your estimate accuracy remained the same.
                {% endif %}
            </p>
        </div>
        {% endif %}
    </div>

    {% next_button %}

</div>

{% endblock %}